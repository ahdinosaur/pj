var Fs = require('fs')
var Url = require('url')
var websocket = require('websocket-stream')
var protobuf = require('protocol-buffers')
var through = require('through2')

var messages = protobuf(fs.readFileSync(__dirname + '/messages.proto'))

module.exports = createApi

function createApi (config) {
  var url = Url.format(config.url)
  return websocket(url)
    .pipe(through(function (buf, enc, cb) {
      cb(null, messages.Pixels.decode(buf))
    }))
}
